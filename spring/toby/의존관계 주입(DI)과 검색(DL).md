# 스프링 IoC 컨테이너
- 스프링 IoC 기능의 대표적인 동작원리는 주로 **의존관계 주입**이다.
- IoC 컨테이너라고 불리던 스프링이 지금은 의존관계 주입 컨테이너 또는 DI 컨테이너라고 많이 불린다.

- 의존 관계 주입이란, 구체적인 의존 오브젝트와 그것을 사용할 주체, 보통 클라이언트라고 부르는 오브젝트를 런타임시에 연결해주는 작업을 말한다.


> 의존관계 주입이란, 다음과 같은 세가지 조건을 충족하는 작업을 말한다.
1. 클래스 모델이나 코드에는 런타임 시점의 의존관계가 드러나지 않는다. 그러기 위해서는 **인터페이스에만 의존**하고 있어야 한다.
2. 런타임 시점의 의존관계는 컨테이너나 팩토리 같은 제 3의 존재가 결정한다.
3. 의존 관계는 사용할 오브젝트에 대한 레퍼런스를 외부에서 제공(주입)해줌으로써 만들어진다.


즉, **의존 관계 주입의 핵심은 설계 시점에는 알지 못했던, 두 오브젝트의 관계를 맺도록 도와주는 제 3의 존재가 있다는 것**이다.

스프링 애플리케이션 컨텍스트, 빈 팩토리, IoC 컨테이너 등이 모두 외부에서 오브젝트 사이의 런타임 관계를 맺어주는 책임을 지닌 제 3의 존재라고 볼 수 있다!

DI 컨테이너에 의해 런타임시에 의존 오브젝트를 사용할 수 있도록 그 레퍼런스를 전달받는 과정이 마치 메서드(생성자)를 통해 DI 컨테이너가 클라이언트에게 주입해주는 것과 같다고 해서 이를 의존관계 주입이라고 부른다.

DI는 자신이 사용할 오브젝트에 대한 선택과 생성 제어권을 외부로 넘기고, 자신은 수동적으로 주입받은 오브젝트를 사용한다는 점에서 IoC 개념에 잘 들어맞는다. 스프링 컨테이너의 IoC는 주로 의존관계 주입 또는 DI라는 데 초점이 맞춰져 있다. 그래서 스프링을 IoC 컨테이너 외에도 DI컨테이너, 또는 DI 프레임워크라고 부르는 것이다.

## 의존관계 검색과 주입
- 스프링이 제공하는 IoC 방법에는 의존관계 주입만 있는 것이 아니다.
- 코드에서는 구체적인 클래스에 의존하지 않고, 런타임시에 의존관계를 결정한다는 점에서 의존 관계 주입과 비슷하지만, 의존관계를 맺는 방법이 외부로부터의 주입이 아니라, **스스로 검색을 이용하기 때문에 의존관계 검색(dependency lookup)**이라고 불리는 것도 있다.
- 의존관계 검색은 자신이 필요로하는 의존 오브젝트를 능동적으로 찾는다.
- 물론 자신이 어떤 클래스의 오브젝트를 이용할 지 결정하지는 않는다.(이러면 IoC라고 할 수 없으니까)
- 의존 관계 검색은 런타임 시 의존관계를 맺을 오브젝트를 결정하는 것과 오브젝트의 생성 작업은 외부 컨테이너에게 IoC로 맡기지만, 이를 가져올 땐 메서드나 생성자를 통한 주입 대신 스스로 컨테이너에게 요청하는 방법을 사용한다.


```java
public UserDao(){
    DaoFactory daoFactory = new DaoFactory();
    this.connectionMaker = daoFactory.connectionMaker();
}
```
여전히 UserDao는 자신이 어떤 ConnectionMaker 오브젝트를 사용할 지 모른다. 의존 대상은 여전히 ConnectionMaker 인터페이스 뿐이다.

런타임시에 DaoFactory가 만들어서 돌려주는 오브젝트와 다이내믹하게 런타임 의존관계를 맺는다. 따라서 이는 IoC개념을 잘 따르고 있다.

DaoFactory의 경우엔 미리 준비된 메서드를 호출하면 되므로, 단순한 요청처럼 보이겠지만, 이를 일반화한 ApplicationContext의 경우에는 미리 정해놓은 이름을 전달해서 그 이름에 해당하는 오브젝트를 찾게 된다. 따라서 이를 **일종의 검색**으로 볼 수 있는 것이다. 또한 그 대상이 런타임 의존관계를 가질 오브젝트이므로, **의존 관계 검색**이라고 부르는 것이다.

스프링의 IoC 컨테이너인 ApplicationContext는 `getBean()`이라는 메서드를 제공한다. **바로 이 메서드가 의존관계 검색에 사용되는 것**이다.

```java
public UserDao() {
    AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(DaoFactory.class);
    this.connectionMaker = context.getBean("connectionMaker", ConnectionMaker.class);
}
```



#### **의존관계 주입과 의존관계 검색의 차이점**
- 의존관계 검색 방식에서는 검색하는 오브젝트는 자신이 스프링의 빈일 필요가 없다.
  - 예를 들어, UserDao에 스프링의 getBean()을 사용한 의존관계 검색 방법을 적용할 때, UserDao는 굳이 스프링이 만들고 관리하는 빈일 필요가 없다 그냥 어딘가에서 new UserDao()를 해서 만들어서 사용해도 된다. 이 때 ConnectionMaker만 스프링의 빈이면 된다.
- 의존관계 주입에서는 UserDao와 ConnectionMaker 사이에 DI가 적용되기 위해서는 **UserDao도 반드시 컨테이너가 만드는 빈 오브젝트여야만 한다.**
  - 컨테이너가 UserDao에 ConnectionMaker 오브젝트를 주입해주려면 UserDao에 대한 **생성과 초기화 권한을 갖고 있어야 하고, 그러려면 UserDao는 IoC 방식으로 컨테이너에서 생성되는 오브젝트, 즉 빈이어야하기 때문이다!!!!**
  - **DI를 원하는 오브젝트는 먼저 자기 자신이 컨테이너가 관리하는 빈이 되어야 한다는 사실을 잊지 말자**
