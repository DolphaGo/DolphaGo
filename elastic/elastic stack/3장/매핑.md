# 매핑
- 엘라스틱 서치에서도 관계형 데이터 베이스의 스키마와 비슷한 역할을 하는 것이 바로 매핑
- **JSON 형태의 데이터를 루씬이 이해할 수 있도록 바꿔주는 작업**
- 엘라스틱 서치가 검색 엔진으로 전문 검색과 대용량 데이터를 빠르게 실시간 검색할 수 있는 이유이기도 함



## 다이내믹 매핑
| 원본 소스 데이터 타입 | 다이내믹 매핑으로 변환된 데이터 타입                  |
| --------------------- | ----------------------------------------------------- |
| null                  | 필드를 추가하지 않음                                  |
| boolean               | boolean                                               |
| float                 | float                                                 |
| integer               | **long**                                              |
| object                | object                                                |
| string                | **string 데이터 형태에 따라 date, text/keyword 필드** |


예를 들어서 JSON 도큐먼트에 "age": 20 이라는 필드와 값이 있으면 엘라스틱 서치는 20을 숫자로 인식한다. integer 타입이라서 엘라스틱 서치는 인덱스 생성시 age를 long타입의 필드로 매핑한다.

근데 무조건 숫자형은 long으로 매핑해서 불필요한 크기를 차지할 수도 있기도 하다.

인덱스 매핑값을 확인해보도록 하자.

![](/images/2022-03-20-23-01-56.png)

나이 같은 경우에는 200살을 넘기기가 힘든데, 수십억을 표현하는 long보다는 메모리를 조금 쓰는 short타입이 더 유리할 수 있다.

또한 country나 gender 같은 범주형 데이터는 전문 검색보단 일반적으로 집계나 정렬, 필터링을 위해 사용되기에 키워드 타입으로 지정하는 것이 좋다.

## 명시적 매핑

- 인덱스 매핑을 직접 정의하는 것을 말한다.
- 인덱스를 생성할 때 mappings를 정의하거나 mapping API를 이용해 매핑을 지정할 수 있다.

인덱스 생성 시 매핑 설정 방법
```
PUT "인덱스 명"
{
    "mappings": {
        "properties": {
            "필드명": "필드 타입"
        }
    }
}
```

> 인덱스 생성하기

![](/images/2022-03-20-23-05-50.png)

> 인덱스 결과 확인하기

![](/images/2022-03-20-23-06-40.png)


## 매핑 타입

엘라스틱 서치 데이터 타입을 알아보자

| 데이터 형태 | 데이터 타입                                                                | 설명                                                                                                                                                                                                                                                                                                      |
| ----------- | -------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 텍스트      | text                                                                       | 전문 검색이 필요한 데이터로, 텍스트 분석기가 텍스트를 작은 단위로 분리한다.                                                                                                                                                                                                                               |
| 텍스트      | keyword                                                                    | 정렬이나, 집계에 사용되는 텍스트 데이터로 분석을 하지 않고 원문을 통째로 인덱싱한다.                                                                                                                                                                                                                      |
| 날짜        | date                                                                       | 날짜/시간 데이터                                                                                                                                                                                                                                                                                          |
| 정수        | byte, short, integer, long                                                 | byte : 부호있는 8비트 데이터, short : 부호 있는 16비트 데이터, integer : 부호 있는 32비트 데이터, long: 부호 있는 64비트 데이터                                                                                                                                                                           |
| 실수        | scaled_float, half_float, double, float                                    | scaled_float : float 데이터에 특정 값을 곱해서 정수형으로 바꾼 데이터. 정확도는 떨어지나 필요에 따라 집계 등에서 효율적으로 사용이 가능하다. half_float : 16비트 부동 소수점 실수 데이터, double: 32비트 부동 소수점 실수 데이터, float: 64비트 부동소수점 실수 데이터(여긴 특이한게 double < float 이네) |
| 불린        | boolean                                                                    | 참/거짓 데이터로 true/false 값만 가진다                                                                                                                                                                                                                                                                   |
| IP 주소     | ip                                                                         | ipv4, ipv6 타입 ip 주소를 입력할 수 있다.                                                                                                                                                                                                                                                                 |
| 위치 정보   | geo-point, geo-shape                                                       | geo-point : 위도, 경도 값을 갖는다. geo-shape : 하나의 위치 포인트가 아닌 임의의 지형                                                                                                                                                                                                                     |
| 범위값      | integer_range, long_range, float_range, double_range, ip_range, date_range | 범위를 설정할 수 있는 데이터, integer_range, long_range는 정수형 범위, float_range, double_range는 실수형 범위, ip_range는 ip 주소 범위, date_range는 날짜/시간 데이터 범위 값을 저장하고 검색할 수 있게 한다. 최솟값과 최댓값을 통해 범위를 입력한다                                                     |
| 객체형      | object                                                                     | 계층 구조를 갖는 형태로 필드 안에 다른 필드들이 들어갈 수 있다. name: {"first": "kim", "last": "DolphaGo"} 로 타입을 정의하면, name.fist/name.last 형태로 접근할 수 있다                                                                                                                                  |
| 배열형      | nested                                                                     | 배열형 객체를 저장한다. 객체를 따로 인덱싱하여 객체가 하나로 합쳐지는(flatten) 것을 막고, 배열 내부의 객체에 쿼리로 접근할 수 있다.                                                                                                                                                                       |
| 배열형      | join                                                                       | 부모(parent)/자식(child) 관계를 표현할 수 있다                                                                                                                                                                                                                                                            |



