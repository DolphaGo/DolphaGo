- [버킷 집계](#버킷-집계)
    - [히스토그램 집계](#히스토그램-집계)

# 버킷 집계

- 버킷 집계는 특정 기준에 맞춰서 도큐먼트를 그룹핑하는 역할
- 여기서 버킷은 도큐먼트가 분할되는 단위로 나뉜 각 그룹을 의미함.
- **특정 목적으로 도큐먼트를 그룹핑하고 싶을 때 버킷집계를 이용**

> 자주 사용하는 버킷 집계 종류

| 버킷 집계         | 설명                                                                                                                                          |
| ----------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| histogram         | 숫자 타입 필드를 일정 간격으로 분류                                                                                                           |
| date_histogram    | 날짜/시간 타입 필드를 일정 날짜/시간 간격으로 분류                                                                                            |
| range             | 숫자 타입 필드를 **사용자가 지정하는 범위 간격으로** 분류                                                                                     |
| date_range        | 날짜/시간 타입 필드를 **사용자가 지정하는 날짜/시간 간격으로** 분류                                                                           |
| terms             | 필드에 많이 나타나는 용어(값)들을 기준으로 분류                                                                                               |
| significant_terms | terms 버킷과 유사하나, 모든 값을 대상으로 하지 않고, **인덱스 내 전체 문서 대비 현재 검색 조건에서 통계적으로 유의미한 값들을 기준으로 분류** |
| filters           | 각 그룹에 포함시킬 문서의 조건을 직접 지정. 이때 조건은 일반적으로 검색에 사용되는 쿼리와 동일함                                              |


### 히스토그램 집계

- 히스토그램 집계(histogram aggregation)는 숫자 타입 필드를 일정 간격(interval) 기준으로 구분해주는 집계이다.
  
> 예제

```json
GET kibana_sample_data_ecommerce/_search
{
  "size": 0,
  "aggs": {
    "histogram_aggs": {
      "histogram": {
        "field": "products.base_price",
        "interval": 100
      }
    }
  }
}
```
![](/images/2022-04-12-01-49-51.png)

- 위 결과는 앞서 지정했던 `histogram_aggs`라는 이름으로 집계 결과를 보여준다.
- 100단위로 구분했는데, key가 0은 필드값이 `0~99` 사이 값을 의미한다.
- key가 100인 것은 `100~199` 사이의 값을 의미하는 것이고..
- doc_count는 버킷에 속한 도큐먼트의 개수인데, base_price의 값이 `0~99` 인 버킷에 도큐먼트가 가장 많고, `1000~1099`인 버킷엔 도큐먼트가 1개 있음을 확인할 수 있다.


