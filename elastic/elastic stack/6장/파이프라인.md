- [파이프라인](#파이프라인)

# 파이프라인

- 파이프라인은 데이터를 입력받아 실시간으로 변경하고 이를 다른 시스템에 전달하는 역할을 하는 로그스태시의 핵심 기능.
- 파이프라인은 입력, 필터, 출력이라는 세가지 구성요소로 이루어진다.
  - 입력과 출력은 필수 구성요소이고, 필터는 옵션이다.

![](/images/2022-04-13-02-29-30.png)

- `입력 -> 필터 -> 출력` 순으로 실행되는 것을 알 수 있다.
- 입력: 소스로부터 데이터를 받아들이는 모듈
- 필터: 입력으로 들어오는 데이터를 원하는 형태로 가공하는 모듈
- 출력: 데이터를 외부로 전달하는 모듈


간단한 예제를 통해 파이프라인 구성하는 방법을 배워보자.
표준 입력(키보드)을 받아서 표준 출력(모니터)에 보여주는 간단한 예제를 다시 한 번 실행해보자.

```sh
➜ bin ./logstash -e "input { stdin { } } output { stdout { } }" --log.level error
```

그리고 `hello world`를 타이핑하면 모니터에 다음과 같이 출력된다.
```sh
hello world
{
       "message" => "hello world",
    "@timestamp" => 2022-04-12T17:31:54.741Z,
      "@version" => "1",
          "host" => "AD01718275.local"
}
```

- 로그스태시는 JSON 형태로 출력하는데, `@version` 이나 `@timestamp` 는 로그스태시가 만든 필드로, 혹시 사용자가 만든 필드와 충돌이 날 것을 대비하여 `@` 기호가 붙어있다.
- message : 데이터, host : 시스템 사용자
  - 여기엔 `@`가 붙지 않았는데, `@`가 붙은건 로그스태시가 생성한 필드, 붙지 않은 필드는 수집을 통해 얻은 정보라고 이해하자.


그러나 작업의 이력관리를 위해 pipelines.yml이나 파이프라인 설정 파일을 만들어 로그스태시를 동작하는 것이 좋다.

> 파이프라인 기본 템플릿
```json
input {
    { 입력 플러그인 }
}

filter {
    { 필터 플러그인 }
}

output {
    { 출력 플러그인 }
}
```

- 파이프라인 구성 요소인 입력, 필터, 출력의 내부에 플러그인을 지정할 수 있다.
- 용도나 형태에 맞춰 이미 만들어진 수많은 플러그인이 있기 때문에 필요한 기능을 지원하는 플로그인을 검색하여 템플릿에 추가하면 된다.

