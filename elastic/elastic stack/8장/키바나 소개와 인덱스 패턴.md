- [키바나 소개](#키바나-소개)
  - [시각화 관점에서의 키바나](#시각화-관점에서의-키바나)
  - [인덱스 패턴](#인덱스-패턴)
    - [키바나에서 인덱스 패턴을 만드는 방법](#키바나에서-인덱스-패턴을-만드는-방법)

---

# 키바나 소개

- 키바나를 단순 데이터 시각화 툴로 오해할 수 있는데, 키바나는 엘라스틱 스택의 관리, 모니터링, 솔루션을 총괄하는 메인 UI이다.

> 키바나의 주요 기능
- **데이터 분석과 시각화 툴**
  - 오픈소스 기반의 데이터 탐색 및 시각화 도구 제공
- **엘라스틱 관리**
  - 보안, 스냅샷, 인덱스 관리, 개발자 도구 등을 제공
- **엘라스틱 중앙 허브**
  - 모니터링을 비롯해 엘라스틱 솔루션을 탐색하기 위한 포털

키바나는 엘라스틱서치 인덱스에 저장된 데이터를 다양한 차트들을 이용해 시각화할 수 있으며, 대시보드나 캔버스 기능을 통해 데이터를 관점별로 분석할 수 있다.

## 시각화 관점에서의 키바나

- 키바나는 시스템의 끝단에서 사용자에게 정보를 효율적으로 제공한다.
- 엘라스틱서치에서 제공되는 시계열 데이터나 위치 분석 같은 다양한 분석 결과를 키바나를 통해 시각화한다.
- 유료 라이선스가 필요한 머신러닝, 네트워크 그래프 기능도 있으나 대부분 무료인 베이직 라이센스 수준에서 제공된다.

> 대표적인 시각화 기능

- **디스커버(Discover)**
  - 데이터를 도큐먼트 단위로 탐색해 구조와 관계 등을 확인할 수 있다.
- **시각화(Visualize)**
  - 다양한 그래프 타입으로 데이터를 시각화를 할 수 있다.
- **대시보드(Dashboard)**
  - 그래프, 지도 등을 한 곳에서 확인하면서 다양한 인사이트를 얻을 수 있다.
- **캔버스(Canvas)**
  - 그래프와 이미지 등을 프레젠테이션 슬라이드처럼 구성할 수 있다.
- **맵스(Maps)**
  - 위치 기반 데이터를 지도 위에 표현할 수 있다.

엘라스틱서치 인덱스에 데이터만 저장되어 있다면, 이 모든 것들을 시각화할 수 있다.

## 인덱스 패턴

- 키바나에서 시각화 하기 위해선 반드시 엘라스틱서치 인덱스에 연결되어야한다.
- 그래서 키바나를 범용적이라고 하긴 어렵지만, 오픈소스이면서 다양한 그래프와 지도를 지원하고 빅데이터 처리가 가능하다는 장점이 있다.
- 키바나는 데이터 소스를 엘라스틱서치 인덱스에서 가져오는데, 이를 **인덱스 패턴(index pattern)** 이라고 한다.
- 키바나 인덱스 패턴은 인덱스 매핑 정보 등을 키바나에 사용하기 적합하게 미리 캐싱해둔 것으로 여러 개의 인덱스에 대한 메타데이터를 병합해 저장해뒀다가 검색이나 시각화 생성 시 활용하게 된다.
- 예를 들어서 키바나 인덱스 패턴은 `syslog-*` 라고 하자.
  - 이 패턴은 키바나에서 활용하기 쉽도록 **필드 포맷 등을 캐싱해둔 메타데이터** 로, 엘라스틱서치의 `syslog-xxx` 인덱스들과 연결되어 있다.
  - 즉 엘라스틱 서치의 인덱스엔 `syslog-202212`, `syslog-202301` 같은 것이다.
- 키바나에서는 엘라스틱서치 인덱스에 직접 접근하지 않고, 인덱스 패턴이라는 것에 접근해 쿼리를 하고 시각화한다. 왜 이렇게 할까?
- **인덱스 패턴을 만드는 이유는 복수의 인덱스에 대한 매핑을 사전에 병합해두어 쿼리 생성이나 시각화에 활용할 수 있기 때문이다.**


### 키바나에서 인덱스 패턴을 만드는 방법

> ElasticSearch 인덱스 생성

```json
PUT kibana_index1/_doc/1
{
  "name": "Kim"
}

PUT kibana_index2/_doc/1
{
  "name": "Lee"
}
```

- `kibana_index1`, `kibana_index2`라는 이름으로 인덱스 2개를 생성했다.
- 데이터가 없으면 인덱스 패턴을 만들 수 없으므로 데이터를 넣어줬다.
- 인덱스를 넣었으니 이제 키바나의 Discover, Visualize 같은 메뉴를 가보자.
- 하지만 방금 만들었던 kibana_index1, kibana_index2 인덱스에 접근할 수 없으므로, 어떤 작업도 진행할 수가 없다.
- **키바나에서는 인덱스 패턴을 통해서만 엘라스틱서치 인덱스에 접근할 수 있다.**
- **키바나는 엘라스틱서치 인덱스가 아니라 키바나 인덱스 패턴을 데이터 소스로 인식하기 때문이다.**

> 키바나 인덱스 패턴을 만들어보자

- Management > Stack Management > Kibana > Index Patterns

![](/images/2022-04-28-23-28-42.png)

![](/images/2022-04-28-23-29-14.png)

- 키바나 인덱스 패턴 이름을 지정하고, 미리 만들어둔 ElasticSearch 인덱스들을 등록한다.
- 인덱스 패턴명에는 와일드카드(*)와 쉼표(,)를 사용해 복수의 패턴을 포함할 수 있고, 패턴 앞에 (-)를 붙여 특정 패턴을 제외할 수도 있다.

![](/images/2022-04-28-23-30-43.png)

- 이제 Discover에서 우리가 방금 만든 인덱스 패턴으로 ES의 인덱스들에 저장된 도큐먼트들을 확인할 수 있다.
![](/images/2022-04-28-23-31-34.png)