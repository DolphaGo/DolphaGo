- [디스커버(Discover)](#디스커버discover)
  - [쿼리바](#쿼리바)
  - [필터바](#필터바)
  - [타임피커](#타임피커)

---
# 디스커버(Discover)

- 사전 준비 : 엘라스틱에서 제공하는 샘플 데이터들을 로드하고 오자.
![](/images/2022-04-28-23-46-41.png)

- 샘플데이터를 로드하면 인덱스를 생성함과 동시에 인덱스 패턴도 만들어준다.
- Discover는 데이터를 확인하고 탐색하기 위한 용도로 사용된다.
- 문서/이벤트/도큐먼트/로그의 시간에 따른 발생량을 히스토그램으로 보여주기도 하고 데이터 구조나 필드 타입 등을 간단히 확인할 수 있다.
- 또한 적절한 쿼리와 필터 등을 이용해 데이터를 탐색해가면서 추후 시각화 등에서 활용할 수 있다.
![](/images/2022-04-28-23-51-25.png)

1. 툴바 : 결과를 저장하고 불러오는 등의 기능 버튼이 위치
2. 인덱스 패턴 : 탐색할 인덱스 패턴 선택 가능
3. 사이드바: 필드 타입과 필드명을 볼 수 있어 데이터 구조를 확인할 수 있음
4. 시계열 히스토그램 : 히스토그램 형태로 시간에 따른 발생량을 확인할 수 있다. **인덱스 패턴에 시간/날짜 필드가 없는 경우에는 보이지 않는다.**
5. 쿼리바 : 쿼리를 이용해 데이터를 검색할 수 있다.
6. 타임피커 : 시계열 데이터의 시간 범위를 조정할 수 있다.
7. 필터바 : 쿼리를 필터처럼 사용할 수 있다.

## 쿼리바

- 쿼리바는 KQL(Kibana Query Language)과 루씬 쿼리 스트링 2가지 언어를 지원한다.
- 특별한 설정이 없으면 쿼리바는 기본적으로 KQL 언어를 이용한다.
- KQL 버튼을 클릭해서 루씬 쿼리스트링으로 변경할 수 있다.
- 쿼리바의 자동 완성 기능을 이용해 손쉽게 쿼리를 구현할 수 있다.


현재 인덱스는 `kibana_sample_data_flights` 이다.
![](/images/2022-04-28-23-56-36.png)

- 쿼리에 대한 필드 타입에 맞춰서 필드가 사용할 수 있는 연산자 종류(문자형이면 `:`, 숫자형이면 `>`, `<` 와 같은 기호들)을 선택할 수 있다.

- 직접 타이핑하지 않아도 모두 KQL에서 지원하므로 선택만 해서 쿼리를 만들어낼 수 있다.
![](/images/2022-04-28-23-58-17.png)

## 필터바

- 필터바는 쿼리바와 하는 역할이 비슷하지만, 필드를 개별적으로 처리할 수 있다.
- 예를 들어 위에서 실행했던 쿼리(`Cancelled: true and DestCountry : "US"`)와 다르게 `Cancelled: true` 결과와 `DestCountry : "US"` 를 따로보려고 한다고 해보자.
- 쿼리바를 이용하면 매번 KQL 형태로 쿼리를 작성해야 한다.
- 쿼리바는 쿼리를 저장하는 기능이 있지만, 어째뜬 쿼리를 실행할 때는 쿼리를 재작성 하는 것이 원칙이다.
- 하지만 필터바는 개별적으로 필드를 제어할 수 있다.
![](/images/2022-04-29-00-00-57.png)

- 필터바 역시 자동완성 기능을 지원한다.
- 고급사용자를 위해 `Edit as Query DSL`에서 DSL 쿼리 문법을 이용해 필터 UI로 제공하기 힘든 복잡한 쿼리도 필터바로 구현 가능하다.
- 생성된 필터바는 여러 용도로 활용이 가능하다.
![](/images/2022-04-29-00-02-24.png)

- 필터바에 2개의 쿼리가 AND로 연산되어있고, 이전 쿼리바의 결과와 동일한 결과가 나온다.
- 2개의 쿼리가 분리되어 있지만, **분리된 쿼리는 AND연산으로 묶이기 때문**이다.
- 생성된 필터를 조합하면 강력한 기능을 구현할 수 있다.

**`Pin across all apps`**

- 만들어진 필터를 핀(pin) 기능처럼 사용한다.
- `Pin across all apps`를 선택하면 그 필터는 사라지지 않고, 모든 앱(대시보드, 시각화)에서 적용된다.
- 예를 들어 Discover 메뉴에서 어떤 필터를 pin해놓고 Dashboard로 가보면 기본적으로 이 필터가 적용된 상태에서 작업이 시작된다.

**`Exclude results`**

- **적용된 필터에 NOT 연산을 추가한다.**

![](/images/2022-04-29-00-06-18.png)

- 도착지가 미국이 아닌 것들만 필터링한다.

**`Temporarily disable`**

- 일시적으로 필터를 비활성화하여 무시한다.
- 다시 활성화하려면 Re-enable 을 선택하면 된다.

## 타임피커

- 타임피커는 날짜/시간 정보를 조작해 데이터를 특정한 날짜/시간 범위내에서 시각화한다.
- **이 기능을 사용하려면, 키바나 인덱스 패턴을 생성할 때 반드시 기본 날짜/시간 필드를 설정해줘야 한다.**

![](/images/2022-04-29-00-09-48.png)
![](/images/2022-04-29-00-09-58.png)

- `Time field`에 현재 키바나 인덱스 패턴에서 사용 가능한 인덱스의 날짜/시간 필드를 모두 보여준다.
- timestamp를 선택하면, timestamp 필드가 기본 날짜/시간 필드가 되고, 타임피커도 timestamp 필드의 날짜/시간 데이터를 기준으로 범위를 지정한다.
- 만약 인덱스에 날짜/시간 필드가 없는 경우 인덱스 패턴을 만들 때 기본 날짜/시간 필드를 지정하지 못하고 타임피커도 사용할 수 없다.
![](/images/2022-04-29-01-07-02.png)

- 세세한 시간 범위를 필터링하여 볼 수 있어 유용하다.