# 패턴 검색

- [패턴 검색](#패턴-검색)
  - [와일드카드 쿼리(wildcard query)](#와일드카드-쿼리wildcard-query)
  - [정규식 쿼리(regexp query)](#정규식-쿼리regexp-query)
    - [`. 기호`](#-기호)
    - [`+ 기호`](#-기호-1)
    - [`* 기호`](#-기호-2)
    - [`? 기호`](#-기호-3)

> 패턴 검색

- 검색하려는 검색어가 길거나, 검색어를 정확히 알지 못하는 경우
- 검색어의 대략적인 키워드나 몇 개의 알파벳만 알고 있다면 패턴을 통한 검색 가능
- 패턴 검색은 와일드카드 쿼리와 정규식 쿼리가 있는데, 두 쿼리 모두 용어 수준 쿼리에 해당하므로 분석기에 의해 분리된 용어를 찾기 위한 쿼리라는 점을 유념하자.
  - 예를 들어서 SQL의 LIKE 검색처럼 원문에서 특정 문자열을 검색하는 용도로는 적합하지 않음.
  - 패턴 검색은 많은 리소스를 사용하기 때문에 권장하진 않으나, 필요할 때 효율적으로 사용하면 도움을 받을 수도 있음

## 와일드카드 쿼리(wildcard query)
- 와일드 카드는 용어를 검색할 때 `*`와 `?`라는 2가지 기호를 사용할 수 있음
- `*`는 공백까지 포함하여 글자 수에 상관없이 모든 문자를 매칭할 수 있음
- `?`는 오직 한 문자만 매칭할 수 있음
- 검색하려는 용어 맨 앞에 `*`와 `?`를 사용하면 속도가 매우 느려지니까 검색어 앞에는 사용하지 말 것


> aabbbcd를 검색할 때 `*` 예시 케이스를 보자
- `*`: 매칭 성공
- `aabbbcd*`: 매칭 성공
- `b*`: 매칭 실패
- `a*e`: 매칭 실패

`*`는 공백이나 여러 문자들과 매칭되며 문자 길이도 크게 상관이 없다.

> aabbbcd를 검색할 때 `?` 예시 케이스를 보자
- `a?bb???`: 매칭 성공
- `a????cd`: 매칭 성공
- `a?`: 매칭 실패
- `aabbbcd?`: 매칭 실패

`?` 기호는 1개의 문자와 매칭된다.
반드시 `?` 기호 하나당 문자 하나와 매칭되기 때문에 **문자의 길이가 중요하다**

```json
GET kibana_sample_data_ecommerce/_search
{
  "_source": "customer_full_name",
  "query": {
    "wildcard": {
      "customer_full_name.keyword": {
        "value": "M?r*"
      }
    }
  }
}
```
- `customer_full_name` 필드는 텍스트 타입과 키워드 타입을 갖는 멀티 필드로, 우리는 `customer_full_name.keyword`라는 키워드 타입의 필드에서 와일드카드 패턴을 적용할 것이다.
- 첫 번째 문자는 M, 두 번째 문자는 (반드시 어떤) 하나의 문자, 세 번째 문자는 r, 그리고 마지막은 글자수에 상관없이 공백이나 어떤 문자가 와도 된다.
  - `Mary`, `Mar`, `Mora dory` 같은 용어가 모두 매칭된다.

## 정규식 쿼리(regexp query)

- 정규식은 특정한 패턴을 가진 문자열을 표현하기 위한 형식 언어
- 주의해야 할 점은 와일드카드에서 사용한 `*`, `?` 기호가 정규식에서는 쓰임이 다르다는 것이다.

### `. 기호`

- 점(.) 기호 정규식의 매칭 성공과 실패 케이스다.
- 점(.)은 하나의 문자를 의미하고, 어떤 문자가 와도 상관없이 매칭되었다고 판단한다.

> 정규식 쿼리(.)를 이용해 aabbbcd 를 검색하는 예시

- `a.b..c.`: 매칭 성공
- `.......`: 매칭 성공
- `aab.`: 매칭 실패
- `a.bbcd`: 매칭 실패


### `+ 기호`

- **+ 기호는 + 기호 앞 문자와 같은 문자가 한 번 이상 반복되면 매칭되었다고 판단한다.**
- b+라고 하면 b 혹은 bbbbb 같은 경우가 매칭되는 것이지, bc, bcd 같은 문자가 매칭되는 것은 아니다.

> 정규식 쿼리(+)를 이용해 aabbbcd 를 검색하는 예시

- `aab+cd`: 매칭 성공
- `a+b+c+d`: 매칭 성공
- `aabbbcd+`: 매칭 성공
- `aabbbcde+`: 매칭 실패

### `* 기호`

- `*`기호 앞 문자와 같은 문자가 0번, 혹은 여러번 반복되면 매칭되었다고 판단한다.
- `+` 기호와 다른 점은 `+` 기호의 경우 반드시 앞 문자가 한번은 나와야 하는데, `*`기호는 앞 문자가 나오지 않아도 상관없다.
- 정규 표현식에서 `+`/`?`/`*` 같은 기호는 맨 앞에 올 수 없다.

> 정규식 쿼리(*)를 이용해 aabbbcd 를 검색하는 예시
- `aab*cd`: 매칭 성공
- `a*b*c*d*`: 매칭 성공
- `aabbbcde*`: 매칭 성공
- `*bbbcd`: 매칭 실패

### `? 기호`

- `?` 기호 앞 문자와 같은 문자가 0번 혹은 1번 나타나면 매칭되었다고 판단한다.
- `b?`의 경우 공백이나 b만 매칭되고, `bb`, `bbbb`같은 경우는 매칭되지 않는다.

> 정규식 쿼리(?)를 이용해 aabbbcd 를 검색하는 예시
- `aa?b?bbcd` : 매칭 성공
- `aabbbcde?`: 매칭 성공
- `aab?bcd`: 매칭 실패
- `a?b??cd`: 매칭 실패
