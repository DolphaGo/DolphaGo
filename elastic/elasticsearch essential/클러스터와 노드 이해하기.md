# 클러스터의 정의

컴퓨터 클러스터는 여러 대의 컴퓨터들이 연결되어, 하나의 시스템처럼 동작하는 컴퓨터들의 집합을 말한다.

# ES 클러스터의 정의

ES도 여러 대의 노드들이 각자의 역할을 바탕으로 연결되어 하나의 시스템처럼 동작하게 되어 있습니다.

- 클러스터의 성능이 부족하면 노드를 늘려서 대응할 수 있습니다.
  - 하지만 노드를 늘린다고 모두 성능을 늘릴 수 있는 것은 아닙니다. (나중에 색인/검색 쪽에서 이야기를 나누도록 하죠)

> ## 노드의 종류

1. 마스터 노드: **클러스터 상태 관리 및 메타데이터 관리**
2. 데이터 노드: 문서 **색인** 및 **검색 요청 처리**
3. 코디네이팅 노드: **검색 요청 처리**
4. 인제스트 노드: 색인되는 문서의 데이터 **전처리**


# 마스터 노드와 마스터 후보 노드

마스터 노드는 다음과 같이 2가지로 구분할 수가 있다.

![](/images/2024-05-16-18-49-28.png)

마스터 노드는 지금 클러스터에서 마스터 노드의 역할을 하고 있는 노드이고,
마스터 후보 노드는 마스터 노드에 문제가 생겼을 때 마스터 노드가 될 수 있는 노드를 말한다.

**마스터 노드가 죽으면 마스터 후보 노드들 중에서 새로운 마스터가 됩니다.**
**마스터 노드는 딱 1대입니다.**

# ES 클러스터 특징

ES도 **여러 대의 노드들이** 각자의 역할을 바탕으로 연결되어 **하나의 시스템처럼** 동작하게 되어있습니다.
**-> 그래서 어떤 노드에 어떤 요청을 해도 동일한 응답을 줍니다.**

다음과 같이 마스터 노드 3, 데이터 노드 3, 코디네이팅 노드 1개가 있다고 가정해보자.

![](/images/2024-05-16-18-52-03.png)

유저로부터 마스터 노드#0 에 어떤 데이터에 대한 요청을 받으면, 데이터 노드 #0(몇 번인지 마스터 노드는 알고 있음)에게 요청해서 받음

- 마스터노드에게 데이터 요청을 해서 데이터를 잘 받았습니다.
- 같은 요청을 데이터 노드에 요청해도 데이터를 잘 받을 수 있게 됩니다.
- 어떤 문서가 어떤 노드에 있는 지 라우팅하는 것들도 뒤에서 알려주도록 하겠습니다.
- 사실 마스터 노드에게 요청을 하고, 마스터 노드가 데이터 노드에게 요청하고 응답받아서 다시 유저에게 건네주는 작업은 불필요합니다.
- 코디 네이팅 노드에게 색인 요청을 해도 잘 동작합니다.
  - 데이터 노드에게 요청을 넘겨서 (PUT /something) 색인 처리를 합니다.

중요한 것은,

**각각의 노드가 본연의 역할에 충실할 수 있도록 구성하는 것이 중요합니다.**

그래서 다음과 같이 클러스터를 구성하는 것이 이상적이다.

 ![](/images/2024-05-16-18-55-48.png)