# 매핑이란

- RDBMS 의 Schema 와 유사한 개념
- 문서의 구조를 나타내는 정보
  - Elasticsearch 는 **스키마리스가 아니라, 미리 정의하지 않아도 될 뿐입니다.**

> 매핑의 종류

| 종류                       | 정의                                                         |
| -------------------------- | ------------------------------------------------------------ |
| 동적 매핑(Dynamic Mapping) | 처음 색인되는 문서를 바탕으로 매핑 정보를 es가 동적으로 생성 |
| 정적 매핑(Static Mapping   | 문서의 매핑 정보를 미리 정의                                 |


> 동적 매핑(Dynamic Mapping)

어떤 문서가 색인될 지 스키마를 미리 정의하지 않아도 됩니다.

**처음 색인되는 문서를 기반으로 자동으로 매핑이 지정됩니다.**

![](/images/2024-05-17-11-50-29.png)

동적 매핑에 의해 매핑 정보가 생성된 후에는 타입이 안맞을 경우 **파싱 에러가 발생** 합니다.

만약 다음과 같이 rating 에 float 방식이 아니라, ""로 묶어서 string 으로 보내면 다음과 같은 에러가 난다. 
![](/images/2024-05-17-11-52-00.png)


> 정적 매핑(Static Mapping)

어떤 문서가 색인될 지 스키마를 미리 정의하는 것입니다.

![](/images/2024-05-17-11-53-11.png)

**library 라는 인덱스를 만들 때, 매핑을 같이 정의하는 것입니다.**

위의 사진을 보면, title 과 rating 만 정적 매핑을 했는데 그럼 type과 author 는 어떻게 되는가?
**-> 동적 매핑으로 만들어 집니다.**

모든 필드를 모두 정적 매핑으로 만들 필요는 없고, **중요한 필드만 정적 타입으로 만들 수 있다.** (유연함)


### 정적 매핑은 언제 도움이 될까요?

1. 문서의 필드들이 가지는 값에 따라 타입을 지정해 줄 필요가 있을 때

ex) float 최대 값을 넘는 값이 들어갈 경우가 있으면 반드시 double 로 정적 매핑 필요하다.

2. 불필요한 색인이 발생하지 않게 하기 위해

ex) 문자열 필드마다 자동 생성되는 keyword 타입
- 키워드 타입이 필요없으면 (키워드 색인이 필요 없다면) 정적 타입으로 불필요한 색인을 막을 수 있다.


> 정리

1. 매핑은 es에 저장되는 문서들의 구조를 나타내는 정보입니다.
2. 매핑을 미리 정의하지 않고 처음으로 색인되는 문서의 구조를 바탕으로 매핑을 자동 생성하는 것을 동적 매핑이라고 합니다.
3. 매핑을 미리 정의하는 것을 정적 매핑이라고 합니다.
4. 매핑이 정의된 후에는 매핑에 맞지 않는 값이 색인될 경우 에러가 발생합니다.
5. 정적 매핑은 문서의 필드들이 가지는 값에 따라 타입을 정의해 둘 필요가 있거나 불필요한 색인이 발생하지 않게 하기 위해 필요합니다.