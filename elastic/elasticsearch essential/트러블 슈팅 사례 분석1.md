# 문제 상황 파악

**"클러스터의 상태가 Green 이 아니에요."**

![](/images/2024-06-02-16-27-20.png)

Yellow 혹은 Red 상태에 따른 영향도를 정확하게 파악하는 것이 먼저입니다.

# 원인 분석

인덱스들 중 누가 Yellow, 누가 Red인가 확인합니다.

cat indices로 인덱스들의 상태를 확인합니다.

![](/images/2024-06-02-16-29-37.png)

오늘이 2022년 12월 1일, 3일 지나면 백업/스냅샷을 찍는다고 하면, 위의 상황에서 2022-11-17, 2022-11-19, 2022-11-20 이라면 백업/스냅샷 데이터가 있다.

그러면, 클러스터의 상태는 red지만, 장애가 아닙니다.
red 지만, 스냅샷을 리스트업하면 되기 때문에 복구하면 되는 상황일테니.

Yellow 혹은 Red 인 인덱스들 중 어떤 샤드들에 문제가 생겼는 지 파악합니다.

cat shards API를 통해 샤드의 상태를 가져옵니다.

`unassigned.reason` 옵션을 추가해줍니다.

![](/images/2024-06-02-16-31-40.png)

2022년 11월 17일이라고 합시다.

프라이머리 샤드가 10개라고 가정해봅시다.

위의 상황에서는 프라이머리 샤드 2개가 비정상이다.

10개 중 2개에 문제가 생기고, 나머지 8개는 정상 동작 중

-> 20% 문서가 유실 될 가능성이 있습니다. (영향범위 파악)

> 정리

- 클러스터의 상태가 Yellow or red일 때 어떤 인덱스들이 영향을 받고 있는 지 파악합니다.
- 영향을 받는 인덱스들 중 어떤 샤드에 문제가 있는 지 파악을 합니다.
- 클러스터의 상태가 Yellow or Red 지만 경우에 따라서는 장애 상황이 아닐 수 있기 때문에 명확한 파악이 중요합니다.