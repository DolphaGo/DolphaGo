# text 와 keyword 타입

둘 다 문자열을 나타내기 위한 타입입니다.

그러나 차이점은 다음과 같습니다.

- text 타입은 전문 검색(Full-text search)을 위해 토큰이 생성되지만, (검색)
- keyword 타입은 Exact Matching 을 위해 토큰이 생성됩니다. (정확하게 일치)

이 차이를 어떻게 확인하는 것이 좋을까요? 가장 정확하고 편하게 확인 가능한 것은 `_anlayze API` 를 사용하는 것입니다.

![](/images/2024-06-01-21-16-16.png)

위와 같이 inverted index 가 만들어졌다.
누군가가 am으로 검색해도 이 문서가 노출될 것이다.
이것이 Full-text search 이다.

다음과 같이 keyword 로 정의되었을 때는 어떨까?

![](/images/2024-06-01-21-17-18.png)

위 상황에서는 boy 라고 검색해도 문서가 노출되지 않는다. (키워드 타입이기 때문이다)

![](/images/2024-06-01-21-18-06.png)

용도가 무엇이냐에 따라서 사용을 달리 하면 됩니다.

그래서 **키워드 타입이 색인 속도가 더 빠릅니다.**
=> CPU 사용이 적습니다.

문자열 필드가 동적 매핑이 되면, text와 keyword 타입 두개가 모두 생성이 됩니다.

![](/images/2024-06-01-21-18-59.png)

author 는 text 타입이 되고, 내부적으로 author.keyword 가 키워드 타입으로 지정이 됩니다.

그래서 하나의 문자열에 2개의 타입이 생성이 됩니다.

그렇기 때문에 문자열의 특성에 따라 text 와 keyword 를 **정적 매핑** 해주면, 성능에 도움이 됩니다.

동적 매핑을 하게 되면, text와 keyword 2개가 생성되기 때문이죠.

정적 매핑을 하게 되면 text 는 text, keyword는 키워드만 색인이 되기 때문에 더 빠릅니다.

## 텍스트와 키워드 타입

| 텍스트로 정의되면 좋을만한 필드 | 키워드로 정의되면 좋을 만한 필드 |
| ------------------------------- | -------------------------------- |
| 주소                            | 성별                             |
| 이름                            | 물품 카테고리                    |
| 물품 상세 정보                  | ...                              |

주소로 예를 들어보면 경기도 남양주시... <- 남양주시만 검색을 해도 주소가 나왔으면 좋겠다.

물품 카테고리를 예를 들어보면, 자동 이라고만 치지 않는다. 자동차, 자전거.. 이렇게 키워드 기반 검색을 하게 될 것이다.

![](/images/2024-06-01-21-23-09.png)

누가 텍스트가 되면 좋고, 누가 키워드이면 좋을까요?

- method 는 keyword
  - 우린 ge, g 라고 검색하지 않기 때문이지요
- user_agent: text
  - 우리가 윈도우 NT 6.1 까지 검색하지 않기 때문, Mozilla/5.0 이런 거 다 안치니까.
- request_uri: 경우에 따라 다를 것
  - api/v1/..., /api/v2/.. 이런 검색을 원한다면 text로 해서 부분 검색을 하는 것이 좋을 것 같기도 합니다. 그게 아니라 타게팅하고 싶다면 키워드로 지정
   

> 정리

- 텍스트와 키워드 타입 모두 문자열을 처리하기 위한 타입입니다.
- 문자열을 동적 매핑하면 텍스트와 키워드 타입이 모두 생성됩니다.
- 키워드가 텍스트 타입보다 색인이 더 빠르게 됩니다. (cpu를 더 적게 사용하기 때문)
- 굳이 토크나이징이 필요하지 않은 경우, 키워드로 정적 매핑을 설정해놓으면 색인 성능에 도움이 됩니다.